name: Container Image Security Scan

on:
  schedule:
    - cron: '35 * * * *' # 35th minute of every hour

env:
  SYSDIG_URL: https://app.au1.sysdig.com
  BYPASS_SCAN_FAIL: false

jobs:
  scan_images:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install Sysdig CLI Scanner
      run: |
        curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/$(curl -L -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)/linux/amd64/sysdig-cli-scanner"
        chmod +x ./sysdig-cli-scanner

    - name: Scan Docker images
      run: |
        # Define your Docker image names here
        images=("nginx:1.24.0-alpine" "redis:7.0.15-alpine")
        for image in "${images[@]}"
        do
          SECURE_API_TOKEN=${{ secrets.SECURE_API_TOKEN }} ./sysdig-cli-scanner --apiurl ${{env.SYSDIG_URL}} "$image" || ${{ env.BYPASS_SCAN_FAIL }}
        done
